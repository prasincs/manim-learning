# Netlify Deployment Guide

This guide explains how to deploy the Manim Learning Project to Netlify for automatic preview generation.

## Overview

The Netlify deployment automatically:
1. Installs all system dependencies (LaTeX, FFmpeg, etc.)
2. Installs Python dependencies (Manim, NumPy, etc.)
3. Renders preview GIFs for all Phase 1 modules
4. Generates a beautiful web gallery to showcase the animations
5. Deploys everything to a public URL

## Quick Start

### 1. Connect to Netlify

1. Go to [Netlify](https://netlify.com)
2. Click "Add new site" â†’ "Import an existing project"
3. Connect your GitHub repository
4. Netlify will auto-detect the configuration from `netlify.toml`

### 2. Build Settings

Netlify will automatically use these settings from `netlify.toml`:

- **Build command**: `bash scripts/netlify_build.sh`
- **Publish directory**: `public`
- **Python version**: 3.11 (from `runtime.txt`)

### 3. Deploy

Once connected, Netlify will automatically:
- Build on every push to your repository
- Generate deploy previews for pull requests
- Deploy to production when you merge to main

## Build Process

The build process (`scripts/netlify_build.sh`) performs these steps:

1. **Install System Dependencies** (~2-3 minutes)
   - LaTeX (for text rendering in Manim)
   - FFmpeg (for video/GIF generation)
   - Cairo, Pango (for graphics)

2. **Install Python Dependencies** (~1-2 minutes)
   - Manim Community Edition
   - NumPy, Pillow
   - Development tools

3. **Render Preview GIFs** (~15-25 minutes)
   - Renders all 14 Phase 1 modules
   - Uses low quality (`-ql`) for faster builds
   - Each GIF is ~500KB - 2MB

4. **Generate Gallery Page** (~10 seconds)
   - Creates index.html with all previews
   - Responsive design for mobile/desktop
   - Organized by learning phase

**Total build time**: ~20-30 minutes

## File Structure

```
manim-learning/
â”œâ”€â”€ netlify.toml              # Netlify configuration
â”œâ”€â”€ runtime.txt               # Python version specification
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ netlify_build.sh      # Main build script
â”œâ”€â”€ public_template/
â”‚   â””â”€â”€ index.html            # Gallery template
â”œâ”€â”€ public/                   # Generated by build (gitignored)
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ previews/
â”‚       â””â”€â”€ phase1/
â”‚           â”œâ”€â”€ 01_hash_intro.gif
â”‚           â”œâ”€â”€ 02_sha256.gif
â”‚           â””â”€â”€ ...
â””â”€â”€ scenes/
    â””â”€â”€ phase1/
        â”œâ”€â”€ 01_hash_intro.py
        â”œâ”€â”€ 02_sha256.py
        â””â”€â”€ ...
```

## Environment Variables

You can customize the build by setting environment variables in Netlify:

### Optional Variables

- `MANIM_QUALITY`: Quality level (`low_quality`, `medium_quality`, `high_quality`)
  - Default: `low_quality`
  - Higher quality = longer build time and larger files

- `MANIM_FORMAT`: Output format (`gif`, `mp4`, `webm`)
  - Default: `gif`
  - GIF is best for inline preview in browsers

- `SKIP_RENDERING`: Set to `true` to skip GIF rendering (for testing)
  - Default: `false`

### Setting Environment Variables

1. Go to your Netlify site dashboard
2. Navigate to "Site settings" â†’ "Environment variables"
3. Add the variables you want to customize

## Build Optimization

### Faster Builds

To speed up builds during development:

1. **Reduce modules**: Comment out modules in `scripts/netlify_build.sh`
2. **Use lower quality**: Already set to `-ql` (low quality)
3. **Enable build cache**: Netlify automatically caches dependencies

### Smaller Deployments

To reduce deployed site size:

1. **Use lower quality**: GIFs at `-ql` are ~500KB each
2. **Reduce frame rate**: Modify Manim scenes to use fewer frames
3. **Compress GIFs**: Add a post-processing step to optimize GIFs

## Monitoring Builds

### Build Logs

1. Go to your Netlify site dashboard
2. Click "Deploys"
3. Click on any deploy to see detailed logs

### Common Issues

#### Build Timeout

**Problem**: Netlify free tier has a 15-minute build timeout.

**Solution**:
- Upgrade to paid tier (increased timeout)
- Reduce number of rendered modules
- Cache dependencies (automatic in Netlify)

#### Out of Memory

**Problem**: Rendering many GIFs uses significant RAM.

**Solution**:
- Render modules sequentially (already implemented)
- Use lower quality settings
- Upgrade Netlify plan for more memory

#### Missing LaTeX Fonts

**Problem**: Text rendering fails due to missing fonts.

**Solution**:
- The build script installs all necessary LaTeX packages
- Check build logs for specific missing fonts
- Add missing packages to `scripts/netlify_build.sh`

## Deploy Previews

Netlify automatically creates deploy previews for pull requests:

1. Open a pull request on GitHub
2. Netlify builds your changes
3. A preview URL is posted in the PR comments
4. Review the rendered GIFs before merging

## Custom Domain

To use a custom domain:

1. Go to "Domain settings" in Netlify
2. Add your custom domain
3. Configure DNS according to Netlify's instructions
4. Enable HTTPS (automatic with Netlify)

## Performance

### Caching

The `netlify.toml` configures caching for:
- GIF files: 7 days
- CSS/JS files: 7 days

This ensures fast loading for repeat visitors.

### CDN

Netlify automatically serves your site through their global CDN for fast loading worldwide.

## Continuous Integration

Every push to your repository triggers:

1. âœ… Build starts automatically
2. âœ… Dependencies installed
3. âœ… GIFs rendered
4. âœ… Gallery generated
5. âœ… Site deployed
6. âœ… Deploy notification sent

### Branch Deploys

You can configure branch-specific deploys:

1. Go to "Site settings" â†’ "Build & deploy" â†’ "Deploy contexts"
2. Enable "Branch deploys"
3. Specify which branches to deploy

## Cost Estimation

### Netlify Free Tier
- âœ… 300 build minutes/month
- âœ… Each build: ~25 minutes
- âœ… ~12 builds per month
- âœ… Perfect for this project!

### Paid Tier ($19/month)
- ðŸš€ 1000 build minutes/month
- ðŸš€ Faster builds
- ðŸš€ More concurrent builds
- ðŸš€ Better for teams

## Local Testing

To test the build locally before deploying:

```bash
# Install Netlify CLI
npm install -g netlify-cli

# Test build locally
netlify build

# Test locally with Netlify dev server
netlify dev
```

## Troubleshooting

### Check Build Status

```bash
# Using Netlify CLI
netlify status

# View recent deploys
netlify deploy:list
```

### Manual Deploy

If automatic deploys aren't working:

```bash
# Build locally
bash scripts/netlify_build.sh

# Deploy manually
netlify deploy --prod
```

### Clear Cache

If builds are failing due to cached dependencies:

1. Go to "Site settings" â†’ "Build & deploy"
2. Click "Clear cache and deploy site"

## Advanced Configuration

### Custom Redirects

Add to `netlify.toml`:

```toml
[[redirects]]
  from = "/old-path"
  to = "/new-path"
  status = 301
```

### Custom Headers

Add to `netlify.toml`:

```toml
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
```

### Build Plugins

Explore Netlify plugins:
- `@netlify/plugin-lighthouse`: Performance audits
- `netlify-plugin-image-optim`: Image optimization
- `netlify-plugin-checklinks`: Link validation

## Resources

- [Netlify Documentation](https://docs.netlify.com/)
- [Netlify Build Environment](https://docs.netlify.com/configure-builds/get-started/)
- [Python on Netlify](https://docs.netlify.com/configure-builds/common-configurations/python/)
- [Manim Documentation](https://docs.manim.community/)

## Support

If you encounter issues:

1. Check [Netlify Community](https://answers.netlify.com/)
2. Review [build logs](#build-logs)
3. Open an issue in this repository
4. Contact Netlify support (paid plans)

---

**Happy deploying!** ðŸš€

Your animations will be live at: `https://your-site-name.netlify.app`
